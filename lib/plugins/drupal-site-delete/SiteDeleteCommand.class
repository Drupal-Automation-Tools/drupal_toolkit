<?php
/**
 * @file Defines the SiteDeleteCommand class.
 */

/**
 * Responsible for handling the site-delete command.
 */
class SiteDeleteCommand extends GenericSiteCommand {
  
  public function verifyRequirements() {
    if (!$this->requireSite()) {
      return FALSE;
    }
    return parent::verifyRequirements();
  }
  
  public function executeCommand() {
    $site = $this->getSite();
    $success = TRUE;
    $context = array(
      'entity' => NULL,
      'name' => EVENT_REMOVE_SUBSITE_ALL,
      'optional' => TRUE,
      'error' => STRING_ERROR_REMOVE_SUBSITE,
      'continue' => TRUE,
    );
    foreach ($site->getSubSites() as $id) {
      $subsite = $site->getSubSite($id);
      $subsite->loadSettings();
      $context['entity'] = $subsite;
      if (!DrupalSiteEvent::fireSiteEvent($this->out(), $this->events(), $context)) {
        $success = FALSE;
      }
    }
    $this->executeSiteCommandStep(EVENT_REMOVE_ALL, FALSE, 0, STRING_UNABLE_TO_REMOVE);
  }
  
}
